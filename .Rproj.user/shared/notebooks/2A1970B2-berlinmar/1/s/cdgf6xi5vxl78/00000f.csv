"0","# Count the number of runners per country and filter for countries with more than 150 runners"
"0","filtered_data <- berlin_2019 %>%"
"0","  group_by(nationality) %>%"
"0","  filter(n() > 20)"
"0",""
"0","# Summarize data by nationality and gender, calculating the median time_full for men and women"
"0","summary_data <- filtered_data %>%"
"0","  group_by(nationality, gender) %>%"
"0","  summarise("
"0","    median_time_full = median(as.numeric(time_full), na.rm = TRUE),"
"0","    .groups = ""drop"""
"0","  )"
"0",""
"0","# Reshape the data to calculate the difference between men and women's median time"
"0","diff_data <- summary_data %>%"
"0","  pivot_wider(names_from = gender, values_from = median_time_full) %>%  # Use pivot_wider instead of spread"
"0","  filter(!is.na(M) & !is.na(W)) %>%  # Ensure both genders have data"
"0","  mutate("
"0","    diff_time_sec = W - M  # Difference in seconds: Womenâ€™s time minus Men's time"
"0","  ) %>%"
"0","  arrange(desc(diff_time_sec)) %>%  # Sort by difference in descending order"
"0","  slice_head(n = 20) %>%  # Select the top 20 countries"
"0","  mutate(nationality = reorder(nationality, diff_time_sec))  # Reorder for plotting"
"0",""
"0","# Plot the top 20 countries with the largest gender median time difference"
"0","ggplot(diff_data, aes(x = nationality, y = diff_time_sec / 60)) +  # Convert seconds to minutes"
"0","  geom_col(fill = ""skyblue"") +  # Use consistent color for bars"
"0","  labs("
"0","    title = ""Top 20 Countries: Gender Median Time Difference"","
"0","    x = ""Nationality"","
"0","    y = ""Time Difference (Minutes)"""
"0","  ) +"
"0","  coord_flip() +  # Flip coordinates for horizontal bars"
"0","  theme_minimal()"
"0",""
